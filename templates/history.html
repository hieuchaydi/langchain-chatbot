{% extends "base.html" %}
{% block title %}L·ªãch s·ª≠ tr√≤ chuy·ªán{% endblock %}

{% block content %}
<div class="history-wrapper">

    <!-- HEADER -->
    <header class="history-header">
        <h1>üìú L·ªãch s·ª≠ tr√≤ chuy·ªán</h1>
        <p>Theo d√µi to√†n b·ªô h·ªôi tho·∫°i gi·ªØa b·∫°n v√† Hidemium AI (theo t·ª´ng session)</p>
    </header>

    <div class="history-layout">

        <!-- CHAT HISTORY -->
        <section class="card chat-history">
            <div class="card-header">
                <h2>üí¨ H·ªôi tho·∫°i</h2>
                <span class="meta">{{ history|length }} tin ‚Ä¢ Trang {{ page }}/{{ total_pages }}</span>
            </div>

            <div class="messages">
                {% if history|length == 0 %}
                    <div class="empty">
                        <p>Ch∆∞a c√≥ cu·ªôc tr√≤ chuy·ªán n√†o</p>
                        <a href="/chat" class="btn primary">B·∫Øt ƒë·∫ßu chat</a>
                    </div>
                {% else %}
                    {% for msg in history %}
                    <div class="msg {{ msg.role }}">
                        <div class="avatar">
                            {{ "üë§" if msg.role == "user" else "ü§ñ" }}
                        </div>
                        <div class="bubble">
                            <div class="bubble-header">
                                <strong>{{ "B·∫°n" if msg.role == "user" else "Hidemium AI" }}</strong>
                                <span>{{ msg.time }}</span>
                            </div>
                            <div class="bubble-body">
                                {{ msg.content | replace("\n", "<br>") | safe }}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>

            {% if total_pages > 1 %}
            <div class="pagination">
                {% if has_prev %}
                    <a href="?page={{ page - 1 }}">‚Üê Tr∆∞·ªõc</a>
                {% endif %}
                <span>Trang {{ page }}</span>
                {% if has_next %}
                    <a href="?page={{ page + 1 }}">Sau ‚Üí</a>
                {% endif %}
            </div>
            {% endif %}
        </section>

        <!-- FILE PANEL -->
        <aside class="card files-panel">
            <div class="card-header">
                <h2>üìÇ T√†i li·ªáu AI</h2>
                <a href="/data-loader" class="btn ghost">Upload</a>
            </div>

            {% if uploaded_files|length == 0 %}
                <div class="empty small">
                    <p>Ch∆∞a c√≥ file .md</p>
                </div>
            {% else %}
                <ul class="file-list">
                    {% for f in uploaded_files %}
                    <li class="file-item">
                        <div>
                            <strong>{{ f.filename }}</strong>
                            <span>{{ f.time }}</span>
                        </div>
                        <form method="post" action="/delete-file">
                            <input type="hidden" name="filename" value="{{ f.filename }}">
                            <button class="icon danger" title="X√≥a">üóë</button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
            {% endif %}
        </aside>

    </div>

    <!-- FOOT ACTIONS -->
    <div class="footer-actions">
        <a href="/" class="btn ghost">Trang ch·ªß</a>
        <a href="/chat" class="btn primary">Chat ti·∫øp</a>
        <a href="/vector-manager" class="btn ghost">Vector Store</a>
    </div>
</div>

{% endblock %}
